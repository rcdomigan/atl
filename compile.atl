;; An Ast->Encode compiler

(def (:: (-> Ast PCode)
         compile)
  (let ((pack-args (foldr compile
                          (return ())
                          args)))
    ([(Fn2 fn args)]
     (>> pack-args
         (put (get-fn-pointer form))
         (put (get-apply-opcode form))))

   ([(Fn1 fn arg)]
    (>> pack-args
        (put (get-fn-pointer fn))
        (put (get-apply-opcode fn))))))
